
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Minecraft 版本库</title>
    <!-- Material Symbols (Rounded & Filled) -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@24,400,1,0" />
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&family=JetBrains+Mono:wght@500&display=swap" rel="stylesheet">
    
    <style>
        /* --- Material Design 3 Design Tokens --- */
        :root {
            /* 核心色板 (M3 Purple Theme) */
            --md-sys-color-primary: #6750A4;
            --md-sys-color-on-primary: #FFFFFF;
            --md-sys-color-primary-container: #EADDFF;
            --md-sys-color-on-primary-container: #21005D;

            --md-sys-color-secondary: #625B71;
            --md-sys-color-secondary-container: #E8DEF8;
            --md-sys-color-on-secondary-container: #1D192B;

            --md-sys-color-tertiary: #7D5260;
            --md-sys-color-tertiary-container: #FFD8E4;
            --md-sys-color-on-tertiary-container: #31111D;

            /* Surface 色调 (营造层次感) */
            --md-sys-color-surface: #FEF7FF;            /* 页面背景 */
            --md-sys-color-surface-container-low: #F7F2FA; /* 低层级容器 */
            --md-sys-color-surface-container: #F3EDF7;     /* 标准容器 */
            --md-sys-color-surface-container-high: #ECE6F0; /* 弹窗/高层级 */
            
            --md-sys-color-on-surface: #1D1B20;
            --md-sys-color-on-surface-variant: #49454F;
            --md-sys-color-outline: #79747E;
            --md-sys-color-outline-variant: #CAC4D0;

            /* 物理动画曲线 */
            /* Spring: 强力回弹，用于进入动画 */
            --motion-spring-force: cubic-bezier(0.3, 1.35, 0.15, 1);
            /* Smooth: 平滑过渡，用于颜色/透明度 */
            --motion-smooth: cubic-bezier(0.4, 0, 0.2, 1);
            
            /* 形状系统 */
            --shape-large: 16px;
            --shape-extra-large: 28px;
            --shape-full: 999px;

            /* 阴影层级 */
            --elevation-1: 0 1px 2px rgba(0,0,0,0.3), 0 1px 3px 1px rgba(0,0,0,0.15);
            --elevation-3: 0 4px 8px 3px rgba(0,0,0,0.15), 0 1px 3px rgba(0,0,0,0.3);
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            -webkit-tap-highlight-color: transparent;
            user-select: none;
            outline: none;
        }

        body {
            font-family: 'Roboto', sans-serif;
            background-color: var(--md-sys-color-surface);
            color: var(--md-sys-color-on-surface);
            display: flex;
            flex-direction: column;
            height: 100vh;
            overflow: hidden;
        }

        /* --- 顶部栏 (Center Aligned) --- */
        .top-app-bar {
            height: 64px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 16px;
            background-color: var(--md-sys-color-surface);
            transition: background-color 0.3s var(--motion-smooth), box-shadow 0.3s;
            z-index: 10;
        }

        /* 滚动时变为 Container 色并添加轻微阴影 */
        .top-app-bar.scrolled {
            background-color: var(--md-sys-color-surface-container);
            box-shadow: 0 2px 4px rgba(0,0,0,0.03);
        }

        .top-app-bar h1 {
            font-size: 22px;
            font-weight: 400;
            color: var(--md-sys-color-on-surface);
            text-align: center;
            flex: 1;
        }

        .icon-btn {
            width: 48px;
            height: 48px;
            border: none;
            background: transparent;
            color: var(--md-sys-color-on-surface-variant);
            border-radius: var(--shape-full);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            position: relative;
            overflow: hidden;
            flex-shrink: 0;
        }

        /* --- 选项卡 (Primary Tabs) --- */
        .tabs-wrapper {
            background-color: var(--md-sys-color-surface);
            transition: background-color 0.3s var(--motion-smooth);
        }
        .top-app-bar.scrolled ~ .tabs-wrapper {
            background-color: var(--md-sys-color-surface-container);
        }

        .tabs {
            display: flex;
            position: relative;
            border-bottom: 1px solid var(--md-sys-color-outline-variant);
        }

        .tab {
            flex: 1;
            height: 48px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            font-weight: 500;
            color: var(--md-sys-color-on-surface-variant);
            cursor: pointer;
            position: relative;
            overflow: hidden;
            z-index: 1;
            transition: color 0.3s;
        }

        .tab.active {
            color: var(--md-sys-color-primary);
        }

        /* 胶囊指示器 (Pill Indicator) */
        .tab-indicator-container {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 33.33%;
            height: 100%;
            display: flex;
            align-items: flex-end;
            justify-content: center;
            pointer-events: none;
            transition: transform 0.5s var(--motion-spring-force);
        }
        
        .tab-indicator {
            width: 50%;
            height: 4px; /* 这里用粗线条模拟 M3，也可以做全包裹胶囊 */
            background-color: var(--md-sys-color-primary);
            border-radius: 4px 4px 0 0;
            margin-bottom: 0;
        }

        /* --- 列表区域 --- */
        main {
            flex: 1;
            overflow-y: auto;
            padding: 16px;
            /* 隐藏滚动条但保留功能 */
            scrollbar-width: none; 
            -ms-overflow-style: none;
        }
        main::-webkit-scrollbar { display: none; }

        .list-container {
            max-width: 600px;
            margin: 0 auto;
            display: flex;
            flex-direction: column;
            gap: 12px;
            padding-bottom: 88px;
        }

        /* --- MD3 卡片 (Elevated Card) --- */
        .card {
            background-color: var(--md-sys-color-surface-container-low);
            border-radius: var(--shape-large); /* 16px */
            padding: 12px 16px 12px 12px;
            display: flex;
            align-items: center;
            position: relative;
            overflow: hidden;
            cursor: pointer;
            box-shadow: 0 0 0 0 transparent;
            transition: background-color 0.2s, transform 0.2s, box-shadow 0.2s;
            
            /* 初始隐藏，等待 JS 触发动画 */
            opacity: 0;
            transform: translateY(30px) scale(0.92);
        }

        /* 强力弹簧进入动画 */
        .card.enter {
            animation: spring-up 0.7s var(--motion-spring-force) forwards;
        }

        @keyframes spring-up {
            0% { opacity: 0; transform: translateY(30px) scale(0.92); }
            100% { opacity: 1; transform: translateY(0) scale(1); }
        }

        .card:active {
            transform: scale(0.96) !important; /* 点击时的反馈 */
            background-color: var(--md-sys-color-surface-container-high);
        }

        .card-icon {
            width: 48px;
            height: 48px;
            border-radius: 12px;
            background-color: #E0E0E0;
            background-image: url('https://assets.mojang.com/block_header_template/grass_block_header.png');
            background-size: cover;
            margin-right: 16px;
            box-shadow: inset 0 0 0 1px rgba(0,0,0,0.05);
            flex-shrink: 0;
        }

        .card-content {
            flex: 1;
            min-width: 0;
        }

        .card-title {
            font-size: 16px;
            font-weight: 500; /* M3 Title Medium */
            color: var(--md-sys-color-on-surface);
            margin-bottom: 2px;
            letter-spacing: 0.15px;
        }

        .card-meta {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 12px;
            color: var(--md-sys-color-on-surface-variant);
        }

        /* 状态胶囊 */
        .badge {
            padding: 4px 10px;
            border-radius: 8px;
            font-size: 11px;
            font-weight: 600;
            line-height: 1;
        }
        .badge.release {
            background-color: var(--md-sys-color-primary-container);
            color: var(--md-sys-color-on-primary-container);
        }
        .badge.snapshot {
            background-color: var(--md-sys-color-tertiary-container);
            color: var(--md-sys-color-on-tertiary-container);
        }

        /* --- FAB --- */
        .fab {
            position: fixed;
            bottom: 24px;
            right: 24px;
            width: 56px;
            height: 56px;
            border-radius: 16px; /* M3 FAB Shape */
            background-color: var(--md-sys-color-primary-container);
            color: var(--md-sys-color-on-primary-container);
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: var(--elevation-3);
            cursor: pointer;
            z-index: 20;
            overflow: hidden;
            transition: transform 0.4s var(--motion-spring-force), box-shadow 0.2s;
        }

        .fab:active { transform: scale(0.9); }
        .fab:hover { box-shadow: 0 6px 10px rgba(0,0,0,0.2); transform: scale(1.05); }

        /* --- Dialog (Full M3 Spec) --- */
        dialog {
            border: none;
            background-color: var(--md-sys-color-surface-container-high);
            border-radius: var(--shape-extra-large); /* 28px */
            padding: 24px;
            width: 85%;
            max-width: 360px; /* Mobile standard */
            box-shadow: var(--elevation-3);
            margin: auto;
            color: var(--md-sys-color-on-surface);
            
            opacity: 0;
            transform: scale(0.8);
            transition: opacity 0.2s, transform 0.4s var(--motion-spring-force), display 0.4s allow-discrete;
        }

        dialog[open] { opacity: 1; transform: scale(1); }
        
        dialog::backdrop {
            background: rgba(0,0,0,0.4);
            backdrop-filter: blur(2px); /* 磨砂玻璃效果 */
            opacity: 0;
            transition: opacity 0.3s;
        }
        dialog[open]::backdrop { opacity: 1; }

        .dialog-header {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-bottom: 16px;
            text-align: center;
        }

        .dialog-icon {
            font-size: 24px;
            color: var(--md-sys-color-secondary);
            margin-bottom: 16px;
        }

        .dialog-title {
            font-size: 24px;
            font-weight: 400; /* Headline Small */
            color: var(--md-sys-color-on-surface);
        }

        .dialog-body {
            font-size: 14px; /* Body Medium */
            color: var(--md-sys-color-on-surface-variant);
            line-height: 1.5;
            margin-bottom: 24px;
        }

        .code-snippet {
            display: block;
            background: #1E1F22;
            color: #BCBEC4;
            padding: 12px;
            border-radius: 12px;
            font-family: 'JetBrains Mono', monospace;
            font-size: 11px;
            overflow-x: auto;
            margin-top: 8px;
            max-height: 200px;
        }

        .dialog-actions {
            display: flex;
            justify-content: flex-end;
            gap: 8px;
        }

        .btn-text {
            background: transparent;
            border: none;
            color: var(--md-sys-color-primary);
            font-size: 14px;
            font-weight: 500;
            padding: 10px 16px;
            border-radius: 20px;
            cursor: pointer;
            position: relative;
            overflow: hidden;
            min-width: 64px;
        }
        .btn-text:hover { background-color: rgba(103, 80, 164, 0.08); }

        /* --- 核心交互：波纹 (Ripple) --- */
        .ripple {
            position: absolute;
            border-radius: 50%;
            background-color: currentColor; /* 继承当前文字颜色 */
            opacity: 0.1;
            transform: scale(0);
            animation: ripple-spread 0.6s linear;
            pointer-events: none;
        }
        
        @keyframes ripple-spread {
            to { transform: scale(2.5); opacity: 0; }
        }

        /* 旋转动画 */
        .spin { animation: rotate 1s linear infinite; }
        @keyframes rotate { 100% { transform: rotate(360deg); } }

    </style>
</head>
<body>

    <!-- 顶部 -->
    <header class="top-app-bar" id="app-bar">
        <button class="icon-btn ripple-trigger" id="btn-source">
            <span class="material-symbols-rounded">code</span>
        </button>
        <h1>Minecraft 版本库</h1>
        <button class="icon-btn ripple-trigger" id="btn-logs">
            <span class="material-symbols-rounded">history</span>
        </button>
    </header>

    <!-- 选项卡 -->
    <div class="tabs-wrapper">
        <nav class="tabs">
            <div class="tab active ripple-trigger" onclick="App.switchTab('all', 0)">全部</div>
            <div class="tab ripple-trigger" onclick="App.switchTab('release', 1)">正式版</div>
            <div class="tab ripple-trigger" onclick="App.switchTab('snapshot', 2)">快照版</div>
            <!-- 胶囊指示器 -->
            <div class="tab-indicator-container" id="indicator-container">
                <div class="tab-indicator"></div>
            </div>
        </nav>
    </div>

    <!-- 列表 -->
    <main id="main-scroll">
        <div class="list-container" id="list-root">
            <!-- 动态生成 -->
        </div>
    </main>

    <!-- FAB -->
    <div class="fab ripple-trigger" onclick="App.fetchData()">
        <span class="material-symbols-rounded" id="fab-icon">refresh</span>
    </div>

    <!-- 详情弹窗 -->
    <dialog id="detail-dialog">
        <div class="dialog-header">
            <span class="material-symbols-rounded dialog-icon">info</span>
            <div class="dialog-title" id="d-title"></div>
        </div>
        <div class="dialog-body">
            <div style="margin-bottom:4px;"><strong>发布类型:</strong> <span id="d-type"></span></div>
            <div style="margin-bottom:12px;"><strong>发布时间:</strong> <span id="d-time"></span></div>
            <div><strong>Manifest URL:</strong></div>
            <div class="code-snippet" id="d-url"></div>
        </div>
        <div class="dialog-actions">
            <button class="btn-text ripple-trigger" onclick="document.getElementById('detail-dialog').close()">关闭</button>
            <button class="btn-text ripple-trigger" onclick="App.copyJson()">复制 JSON</button>
        </div>
    </dialog>

    <!-- 日志弹窗 -->
    <dialog id="log-dialog">
        <div class="dialog-header" style="align-items: flex-start; text-align: left;">
            <div class="dialog-title" style="font-size:20px;">运行日志</div>
        </div>
        <div class="dialog-body" style="padding: 0;">
            <div id="log-container" class="code-snippet" style="height: 200px; background: #2b2d31; color: #ccc; margin-top:0;"></div>
        </div>
        <div class="dialog-actions" style="margin-top: 16px;">
            <button class="btn-text ripple-trigger" onclick="Logger.clear()">清空</button>
            <button class="btn-text ripple-trigger" onclick="document.getElementById('log-dialog').close()">关闭</button>
        </div>
    </dialog>

    <!-- 源码弹窗 -->
    <dialog id="source-dialog">
        <div class="dialog-header">
            <div class="dialog-title">网页源码</div>
        </div>
        <div class="dialog-body">
            <div id="source-preview" class="code-snippet" style="height: 300px;"></div>
        </div>
        <div class="dialog-actions">
            <button class="btn-text ripple-trigger" onclick="document.getElementById('source-dialog').close()">关闭</button>
            <button class="btn-text ripple-trigger" onclick="App.copySource()">复制全部</button>
        </div>
    </dialog>

    <script>
        // --- 日志系统 ---
        const Logger = {
            add(msg, level = 'INFO') {
                const box = document.getElementById('log-container');
                const time = new Date().toLocaleTimeString('zh-CN', {hour12:false});
                const color = level === 'ERROR' ? '#ff6b6b' : (level === 'ACTION' ? '#74c0fc' : '#a5d8ff');
                
                const line = document.createElement('div');
                line.style.marginBottom = '4px';
                line.style.fontSize = '11px';
                line.style.borderBottom = '1px solid #333';
                line.style.paddingBottom = '2px';
                line.innerHTML = `<span style="color:#666">[${time}]</span> <span style="color:${color}">${msg}</span>`;
                
                box.appendChild(line);
                box.scrollTop = box.scrollHeight;
            },
            clear() {
                document.getElementById('log-container').innerHTML = '';
                this.add('日志已清空', 'ACTION');
            }
        };

        // --- 应用逻辑 ---
        const App = {
            data: [],
            currentFilter: 'all',
            detailData: null,

            init() {
                Logger.add('应用初始化...', 'INFO');
                this.setupRipple();
                this.setupScroll();
                this.bindDialogs();
                this.fetchData();
            },

            // 核心：无代理直连
            async fetchData() {
                const listRoot = document.getElementById('list-root');
                const fabIcon = document.getElementById('fab-icon');
                
                fabIcon.classList.add('spin');
                listRoot.innerHTML = '<div style="text-align:center; padding:40px; color:var(--md-sys-color-outline);">正在连接 Mojang 服务器...</div>';
                Logger.add('发起请求: launchermeta.mojang.com', 'ACTION');

                try {
                    // 直连请求
                    const res = await fetch('https://launchermeta.mojang.com/mc/game/version_manifest.json');
                    
                    if (!res.ok) throw new Error(`HTTP ${res.status}`);
                    
                    const json = await res.json();
                    this.data = json.versions;
                    Logger.add(`成功获取 ${this.data.length} 个版本`, 'INFO');
                    this.render();
                    
                } catch (err) {
                    console.error(err);
                    Logger.add(`请求失败: ${err.message}`, 'ERROR');
                    listRoot.innerHTML = `
                        <div style="text-align:center; padding:40px; color:var(--md-sys-color-error);">
                            <span class="material-symbols-rounded" style="font-size:48px; color:#ba1a1a; margin-bottom:16px;">cloud_off</span>
                            <p>连接失败</p>
                            <p style="font-size:12px; opacity:0.7; margin-top:8px;">${err.message}</p>
                            <p style="font-size:12px; opacity:0.7; color:#ba1a1a;">请检查是否允许跨域 (CORS)</p>
                        </div>`;
                } finally {
                    setTimeout(() => fabIcon.classList.remove('spin'), 500);
                }
            },

            switchTab(type, idx) {
                if (this.currentFilter === type) return;
                this.currentFilter = type;
                Logger.add(`切换视图: ${type}`, 'ACTION');

                // UI 更新
                document.querySelectorAll('.tab').forEach((t, i) => t.classList.toggle('active', i === idx));
                document.getElementById('indicator-container').style.transform = `translateX(${idx * 100}%)`;

                this.render();
            },

            render() {
                const root = document.getElementById('list-root');
                root.innerHTML = '';

                const list = this.data.filter(v => this.currentFilter === 'all' || v.type === this.currentFilter);

                if (list.length === 0) {
                    if (this.data.length > 0) root.innerHTML = '<div style="text-align:center; padding:40px; opacity:0.5">无此类版本</div>';
                    return;
                }

                // 限制渲染数量优化性能
                const fragment = document.createDocumentFragment();
                list.slice(0, 100).forEach((v, i) => {
                    const el = document.createElement('div');
                    el.className = 'card ripple-trigger';
                    // 动态设置动画延迟，制造交错感
                    el.style.animationDelay = `${Math.min(i * 0.04, 0.5)}s`;
                    
                    // 稍后添加类名触发动画，防止页面卡顿时动画直接跳过
                    requestAnimationFrame(() => el.classList.add('enter'));

                    const isRelease = v.type === 'release';
                    
                    el.innerHTML = `
                        <div class="card-icon"></div>
                        <div class="card-content">
                            <div class="card-title">${v.id}</div>
                            <div class="card-meta">
                                <span class="badge ${isRelease ? 'release' : 'snapshot'}">${isRelease ? '正式版' : '快照'}</span>
                                <span style="margin-left: auto;">${new Date(v.releaseTime).toLocaleDateString()}</span>
                            </div>
                        </div>
                        <span class="material-symbols-rounded" style="color:var(--md-sys-color-outline-variant);">chevron_right</span>
                    `;

                    el.onclick = (e) => this.showDetail(v);
                    fragment.appendChild(el);
                });
                root.appendChild(fragment);
            },

            showDetail(v) {
                this.detailData = v;
                Logger.add(`查看详情: ${v.id}`, 'ACTION');

                document.getElementById('d-title').textContent = v.id;
                document.getElementById('d-type').textContent = v.type;
                document.getElementById('d-time').textContent = v.releaseTime;
                document.getElementById('d-url').textContent = v.url;
                
                document.getElementById('detail-dialog').showModal();
            },

            copyJson() {
                if (this.detailData) {
                    navigator.clipboard.writeText(JSON.stringify(this.detailData, null, 2));
                    Logger.add('已复制 JSON', 'INFO');
                }
            },
            
            copySource() {
                navigator.clipboard.writeText(document.documentElement.outerHTML);
                Logger.add('已复制源码', 'INFO');
            },

            // --- 交互与事件 ---
            setupScroll() {
                const main = document.getElementById('main-scroll');
                const bar = document.getElementById('app-bar');
                main.addEventListener('scroll', () => {
                    if (main.scrollTop > 10) bar.classList.add('scrolled');
                    else bar.classList.remove('scrolled');
                });
            },

            bindDialogs() {
                document.getElementById('btn-logs').onclick = () => document.getElementById('log-dialog').showModal();
                document.getElementById('btn-source').onclick = () => {
                    document.getElementById('source-preview').textContent = document.documentElement.outerHTML;
                    document.getElementById('source-dialog').showModal();
                };
                // 点击遮罩关闭
                document.querySelectorAll('dialog').forEach(d => {
                    d.addEventListener('click', e => { if(e.target === d) d.close(); });
                });
            },

            // 波纹系统
            setupRipple() {
                document.addEventListener('mousedown', (e) => {
                    const target = e.target.closest('.ripple-trigger');
                    if (!target) return;

                    const rect = target.getBoundingClientRect();
                    const maxDim = Math.max(rect.width, rect.height);
                    const ripple = document.createElement('div');
                    
                    ripple.className = 'ripple';
                    ripple.style.width = ripple.style.height = `${maxDim * 2}px`;
                    ripple.style.left = `${e.clientX - rect.left - maxDim}px`;
                    ripple.style.top = `${e.clientY - rect.top - maxDim}px`;
                    
                    target.appendChild(ripple);
                    setTimeout(() => ripple.remove(), 600);
                });
            }
        };

        window.addEventListener('DOMContentLoaded', () => App.init());
    </script>
</body>
</html>
