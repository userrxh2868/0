<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Âπ¥Â∫¶ËøõÂ∫¶Êù° Ultimate Fix</title>
    <!-- ÂºïÂÖ• Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@300;400;500;700;900&family=Roboto+Mono:wght@400;500;700&family=Roboto:wght@300;400;500;700;900&family=Playfair+Display:ital,wght@0,400;0,700;1,400&family=Press+Start+2P&family=Dancing+Script:wght@700&display=swap" rel="stylesheet">
    
    <style>
        :root {
            /* ÈªòËÆ§ÂèòÈáè */
            --primary-hue: 265;
            --primary-color: hsl(var(--primary-hue), 100%, 60%);
            --accent-color: #00bfa5;
            
            --font-main: 'Roboto', 'Noto Sans SC', sans-serif;
            --font-mono: 'Roboto Mono', monospace;
            
            --bg-base: #f0f2f5;
            --card-bg: rgba(255, 255, 255, 0.65);
            --modal-bg: rgba(255, 255, 255, 0.95);
            --text-color: #1a1a1a;
            --text-secondary: #5f6368;
            --code-bg: #f8f9fa;
            --code-color: #24292e;
            
            --shadow-elevation: 0 20px 40px rgba(0,0,0,0.08);
            --bar-height: 40px;
            --bar-height-sm: 8px;
            
            --btn-border: rgba(255, 255, 255, 0.6);
            --btn-bg: rgba(255, 255, 255, 0.5);
            
            /* ÊûÅÂÖâÈ¢úËâ≤ */
            --blob-color-1: hsla(var(--primary-hue), 80%, 60%, 0.25);
            --blob-color-2: hsla(calc(var(--primary-hue) + 40), 90%, 55%, 0.25);
            --blob-color-3: hsla(calc(var(--primary-hue) - 40), 90%, 55%, 0.25);

            --blur-val: 40px;
        }

        [data-theme="dark"] {
            --bg-base: #050505;
            --card-bg: rgba(20, 20, 20, 0.65);
            --modal-bg: rgba(30, 30, 30, 0.95);
            --text-color: #f0f0f0;
            --text-secondary: #a0a0a0;
            --code-bg: #121212;
            --code-color: #d4d4d4;
            --shadow-elevation: 0 30px 60px rgba(0,0,0,0.6);
            --btn-border: rgba(255, 255, 255, 0.15);
            --btn-bg: rgba(0, 0, 0, 0.3);
            
            --blob-color-1: hsla(var(--primary-hue), 80%, 60%, 0.15);
            --blob-color-2: hsla(calc(var(--primary-hue) + 40), 90%, 55%, 0.15);
            --blob-color-3: hsla(calc(var(--primary-hue) - 40), 90%, 55%, 0.15);
        }

        /* 
           ========================================
           ÊÄßËÉΩÊ®°Âºè‰øÆÂ§ç (Performance Mode Fix) 
           ========================================
        */
        body.perf-mode {
            --blur-val: 0px; 
            --bg-base: #e0e0e0;
        }
        body[data-theme="dark"].perf-mode {
            --bg-base: #000000;
        }
        
        /* Âº∫Âà∂Ë¶ÜÁõñÔºöÂú®ÊÄßËÉΩÊ®°Âºè‰∏ãÂÆåÂÖ®ÁßªÈô§ÈÄèÊòéÂ∫¶ÂíåÊ®°Á≥äÔºå‰ΩøÁî®ÂÆûËâ≤ËÉåÊôØ */
        body.perf-mode .container {
            background: #ffffff !important; 
            opacity: 1 !important; 
            transform: translateY(0) !important; 
            animation: none !important;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1) !important;
            backdrop-filter: none !important;
            -webkit-backdrop-filter: none !important;
            border: 1px solid rgba(0,0,0,0.1);
        }
        
        body[data-theme="dark"].perf-mode .container {
            background: #1a1a1a !important;
            border: 1px solid #333;
        }
        
        body.perf-mode .settings-panel, 
        body.perf-mode .icon-btn,
        body.perf-mode .modal-content {
            backdrop-filter: none !important;
            -webkit-backdrop-filter: none !important;
            background: var(--modal-bg);
            opacity: 1 !important;
            animation: none !important;
        }
        
        body[data-theme="dark"].perf-mode .settings-panel,
        body[data-theme="dark"].perf-mode .modal-content {
            background: #1e1e1e !important;
        }

        body.perf-mode .aurora-bg { display: none; }
        body.perf-mode .progress-bar { box-shadow: none; animation: none; }
        body.perf-mode .progress-bar::after { display: none; } 

        /* Â≠ó‰ΩìÈ¢ÑËÆæ */
        body.font-serif { --font-main: 'Playfair Display', serif; --font-mono: 'Playfair Display', serif; }
        body.font-pixel { --font-main: 'Press Start 2P', cursive; --font-mono: 'Press Start 2P', cursive; font-size: 12px; }
        body.font-hand { --font-main: 'Dancing Script', cursive; --font-mono: 'Dancing Script', cursive; }

        /* Âü∫Á°ÄÈáçÁΩÆ */
        * { margin: 0; padding: 0; box-sizing: border-box; outline: none; -webkit-tap-highlight-color: transparent; }

        body {
            font-family: var(--font-main);
            background-color: var(--bg-base);
            height: 100vh;
            width: 100vw;
            overflow: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
            color: var(--text-color);
            position: relative;
            transition: all 0.5s ease;
        }

        /* ÊûÅÂÖâËÉåÊôØ */
        .aurora-bg { position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 0; overflow: hidden; pointer-events: none; }
        .blob { position: absolute; border-radius: 50%; filter: blur(80px); animation: moveBlob 20s infinite alternate; opacity: 0.8; transition: background 1s ease; }
        .blob-1 { width: 60vw; height: 60vw; background: var(--blob-color-1); top: -10%; left: -10%; animation-duration: 25s; }
        .blob-2 { width: 50vw; height: 50vw; background: var(--blob-color-2); bottom: -10%; right: -10%; animation-duration: 30s; animation-direction: alternate-reverse; }
        .blob-3 { width: 40vw; height: 40vw; background: var(--blob-color-3); top: 30%; left: 30%; animation-duration: 35s; }

        /* Á≤íÂ≠êÁîªÂ∏É */
        #particle-canvas { position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 1; pointer-events: none; }

        /* ÊÇ¨ÊµÆÂ∑•ÂÖ∑Ê†è */
        .floating-toolbar { position: fixed; top: 25px; right: 25px; z-index: 100; display: flex; gap: 12px; }
        .icon-btn {
            background: var(--btn-bg); border: 1px solid var(--btn-border);
            backdrop-filter: blur(12px); -webkit-backdrop-filter: blur(12px);
            cursor: pointer; width: 46px; height: 46px; border-radius: 14px;
            color: var(--text-color); transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
            display: flex; align-items: center; justify-content: center;
            box-shadow: 0 4px 15px rgba(0,0,0,0.05);
        }
        .icon-btn:hover, .icon-btn.active {
            transform: translateY(-4px) scale(1.05); box-shadow: 0 10px 25px rgba(0,0,0,0.15);
            background: var(--primary-color); border-color: var(--primary-color); color: #fff;
        }
        .icon-btn svg { width: 22px; height: 22px; fill: currentColor; }

        /* ËÆæÁΩÆÈù¢Êùø */
        .settings-panel {
            position: fixed; top: 85px; right: 25px; z-index: 99;
            background: var(--card-bg); backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px);
            border: 1px solid var(--btn-border); border-radius: 20px;
            padding: 20px; box-shadow: var(--shadow-elevation);
            width: 280px;
            transform: translateX(120%); opacity: 0;
            transition: all 0.4s cubic-bezier(0.19, 1, 0.22, 1);
        }
        .settings-panel.open { transform: translateX(0); opacity: 1; }
        
        .setting-group { margin-bottom: 20px; }
        .setting-group:last-child { margin-bottom: 0; }
        .setting-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
        .setting-label { font-size: 0.8rem; font-weight: 700; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 1px; }
        
        .toggle-switch { position: relative; display: inline-block; width: 40px; height: 20px; }
        .toggle-switch input { opacity: 0; width: 0; height: 0; }
        .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: rgba(128,128,128,0.3); transition: .4s; border-radius: 20px; }
        .slider:before { position: absolute; content: ""; height: 16px; width: 16px; left: 2px; bottom: 2px; background-color: white; transition: .4s; border-radius: 50%; box-shadow: 0 2px 4px rgba(0,0,0,0.2); }
        input:checked + .slider { background-color: var(--primary-color); }
        input:checked + .slider:before { transform: translateX(20px); }

        .option-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 8px; }
        .color-opt { width: 100%; padding-bottom: 100%; border-radius: 50%; cursor: pointer; border: 2px solid transparent; transition: transform 0.2s; position: relative; }
        .color-opt:hover { transform: scale(1.1); }
        .color-opt.active { border-color: var(--text-color); }
        
        .font-opt { padding: 8px; border: 1px solid var(--btn-border); background: var(--btn-bg); border-radius: 8px; cursor: pointer; text-align: center; font-size: 1.2rem; transition: all 0.2s; display: flex; align-items: center; justify-content: center; }
        .font-opt:hover, .font-opt.active { background: var(--primary-color); color: #fff; }

        /* ‰∏ªÂç°ÁâáÂÆπÂô® */
        .container {
            position: relative; z-index: 2; width: 94%; max-width: 820px;
            background: var(--card-bg); 
            backdrop-filter: blur(var(--blur-val)); -webkit-backdrop-filter: blur(var(--blur-val));
            border-radius: 36px; padding: 45px;
            box-shadow: var(--shadow-elevation); border: 1px solid rgba(255, 255, 255, 0.2);
            animation: floatUp 0.8s cubic-bezier(0.2, 0.8, 0.2, 1) forwards, breathe 6s ease-in-out infinite;
            opacity: 0; transform: translateY(40px);
            display: flex; flex-direction: column; align-items: center;
        }

        h1 { font-size: 2.5rem; font-weight: 900; margin-bottom: 5px; color: var(--text-color); letter-spacing: -1px; display: flex; align-items: center; justify-content: center; gap: 10px; flex-wrap: wrap; }
        .year-input { background: transparent; border: none; border-bottom: 3px solid var(--primary-color); font-family: inherit; font-size: 2.5rem; font-weight: 900; width: 140px; text-align: center; color: var(--primary-color); transition: all 0.3s; padding: 0 5px; }
        .year-input:focus { border-bottom-color: var(--accent-color); background: rgba(128,128,128,0.05); border-radius: 8px 8px 0 0; }

        .date-display { font-size: 1.1rem; color: var(--text-color); margin-bottom: 10px; font-weight: 500; font-family: var(--font-mono); opacity: 0.8; }
        .quote-display { font-size: 0.95rem; color: var(--text-secondary); margin-bottom: 25px; font-style: italic; position: relative; text-align: center; }

        .percent-wrapper { position: relative; margin-bottom: 15px; width: 100%; text-align: center; }
        .percent-display {
            font-size: 4.8rem; font-weight: 300; font-family: var(--font-mono);
            color: var(--text-color); line-height: 1; letter-spacing: -2px; font-variant-numeric: tabular-nums;
            background: linear-gradient(135deg, var(--primary-color), #ff0055);
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
            transition: font-size 0.3s;
        }

        .progress-container { width: 100%; height: var(--bar-height); background: rgba(128, 128, 128, 0.1); border-radius: 50px; overflow: hidden; margin-bottom: 10px; box-shadow: inset 0 2px 8px rgba(0,0,0,0.06); position: relative; border: 1px solid rgba(255,255,255,0.2); }
        .progress-bar { height: 100%; width: 0%; border-radius: 50px; background: linear-gradient(90deg, var(--primary-color), var(--accent-color)); background-size: 200% 100%; position: relative; box-shadow: 0 0 30px var(--blob-color-1); transition: width 0.1s linear; animation: gradientMove 4s ease infinite; }
        .progress-bar::after { content: ''; position: absolute; top: 0; left: 0; bottom: 0; right: 0; background: linear-gradient(90deg, transparent, rgba(255,255,255,0.8), transparent); transform: translateX(-100%); animation: shimmer 2.5s infinite; }

        .milestone-text { width: 100%; text-align: right; font-size: 0.8rem; color: var(--primary-color); margin-bottom: 20px; font-weight: 700; opacity: 0.9; }

        .day-progress-section { width: 100%; display: flex; flex-direction: column; align-items: center; margin-bottom: 25px; }
        .day-label { font-size: 0.75rem; color: var(--text-secondary); margin-bottom: 5px; text-transform: uppercase; letter-spacing: 1px; width: 100%; display: flex; justify-content: space-between; }
        .day-progress-container { width: 100%; height: var(--bar-height-sm); background: rgba(128, 128, 128, 0.1); border-radius: 10px; overflow: hidden; }
        .day-progress-bar { height: 100%; width: 0%; background: var(--text-color); border-radius: 10px; opacity: 0.5; }

        .stats-grid { display: grid; grid-template-columns: repeat(3, 1fr); width: 100%; gap: 15px; padding-bottom: 25px; border-bottom: 1px solid var(--btn-border); margin-bottom: 25px; }
        .stat-item { display: flex; flex-direction: column; align-items: center; padding: 15px 10px; border-radius: 18px; transition: all 0.3s; background: rgba(255,255,255,0.05); }
        .stat-item:hover { background: rgba(255,255,255,0.1); transform: translateY(-3px); }
        .stat-value { font-size: 1.6rem; font-weight: 700; margin-bottom: 4px; font-family: var(--font-mono); }
        .stat-label { font-size: 0.8rem; color: var(--text-secondary); text-transform: uppercase; }

        .detail-title { width: 100%; text-align: left; font-size: 0.85rem; color: var(--text-secondary); margin-bottom: 15px; font-weight: 800; text-transform: uppercase; letter-spacing: 1.5px; display: flex; align-items: center; }
        .detail-title::after { content: ''; flex: 1; height: 1px; background: var(--btn-border); margin-left: 15px; opacity: 0.5; }
        
        /* ËØ¶ÊÉÖÂàóÂ∏ÉÂ±Ä‰ºòÂåñ: PC 4Âàó, Mobile 2Âàó */
        .detail-grid { display: grid; grid-template-columns: repeat(4, 1fr); width: 100%; gap: 10px; }
        .detail-card { background: var(--btn-bg); border: 1px solid var(--btn-border); border-radius: 16px; padding: 12px 4px; text-align: center; display: flex; flex-direction: column; justify-content: center; transition: transform 0.2s; min-height: 80px; }
        .detail-card:hover { transform: scale(1.05); }
        .detail-val { font-weight: 700; font-size: 1.1rem; color: var(--primary-color); margin-bottom: 4px; font-family: var(--font-mono); }
        .detail-lbl { font-size: 0.65rem; color: var(--text-secondary); font-weight: 500; line-height: 1.2; }

        .footer-info { margin-top: 20px; font-size: 0.75rem; color: var(--text-secondary); opacity: 0.6; font-family: var(--font-mono); display: flex; gap: 15px; }

        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); backdrop-filter: blur(10px); z-index: 200; display: flex; justify-content: center; align-items: center; opacity: 0; pointer-events: none; transition: opacity 0.3s ease; }
        .modal-overlay.active { opacity: 1; pointer-events: all; }
        .modal-content { width: 90%; max-width: 900px; height: 85%; background: var(--modal-bg); border-radius: 28px; box-shadow: 0 40px 100px rgba(0,0,0,0.5); display: flex; flex-direction: column; overflow: hidden; transform: scale(0.9); transition: transform 0.4s; border: 1px solid rgba(255,255,255,0.1); }
        .modal-overlay.active .modal-content { transform: scale(1); }
        .modal-header { padding: 20px 30px; border-bottom: 1px solid var(--btn-border); display: flex; justify-content: space-between; align-items: center; }
        .modal-body { flex: 1; overflow: hidden; position: relative; }
        .code-area { width: 100%; height: 100%; padding: 25px; background: var(--code-bg); color: var(--code-color); font-family: 'Roboto Mono', monospace; font-size: 0.85rem; border: none; resize: none; white-space: pre; overflow: auto; }
        .modal-footer { padding: 20px 30px; display: flex; justify-content: flex-end; gap: 15px; background: var(--modal-bg); border-top: 1px solid var(--btn-border); }
        .btn { padding: 12px 28px; border-radius: 12px; border: none; cursor: pointer; font-weight: 700; transition: all 0.2s; font-family: var(--font-main); }
        .btn-primary { background: var(--primary-color); color: white; }

        @keyframes floatUp { to { transform: translateY(0); opacity: 1; } }
        @keyframes breathe { 0%, 100% { transform: scale(1); box-shadow: var(--shadow-elevation); } 50% { transform: scale(1.005); box-shadow: 0 25px 50px rgba(0,0,0,0.12); } }
        @keyframes gradientMove { 0% { background-position: 0% 50%; } 50% { background-position: 100% 50%; } 100% { background-position: 0% 50%; } }
        @keyframes shimmer { 100% { transform: translateX(100%); } }
        @keyframes moveBlob { 0% { transform: translate(0, 0) scale(1); } 100% { transform: translate(30px, -30px) scale(1.1); } }

        @media (max-width: 600px) {
            .floating-toolbar { top: 15px; right: 15px; gap: 8px; }
            .settings-panel { right: 15px; top: 70px; width: 240px; }
            .container { padding: 25px 15px; width: 95%; border-radius: 24px; }
            h1 { font-size: 1.6rem; }
            .year-input { font-size: 1.6rem; width: 90px; }
            .percent-display { font-size: 2.8rem; letter-spacing: -1px; }
            .stats-grid { grid-template-columns: 1fr; gap: 10px; }
            .stat-item { flex-direction: row; justify-content: space-between; padding: 12px 15px; background: rgba(128,128,128,0.05); }
            /* ÊâãÊú∫Á´ØËØ¶ÊÉÖÁΩëÊ†ºÈÄÇÈÖç */
            .detail-grid { grid-template-columns: repeat(2, 1fr); gap: 8px; } 
            body.font-pixel .percent-display { font-size: 1.5rem; line-height: 1.5; }
        }
    </style>
</head>
<body class="font-modern">

    <!-- ÊûÅÂÖâËÉåÊôØ -->
    <div class="aurora-bg">
        <div class="blob blob-1"></div>
        <div class="blob blob-2"></div>
        <div class="blob blob-3"></div>
    </div>

    <!-- Á≤íÂ≠êÂ±Ç -->
    <canvas id="particle-canvas"></canvas>

    <!-- ÊÇ¨ÊµÆÂ∑•ÂÖ∑Ê†è -->
    <div class="floating-toolbar">
        <button class="icon-btn" onclick="toggleFullScreen()" title="Ê≤âÊµ∏Ê®°Âºè">
            <svg viewBox="0 0 24 24"><path d="M7 14H5v5h5v-2H7v-3zm-2-4h2V7h3V5H5v5zm12 7h-3v2h5v-5h-2v3zM14 5v2h3v3h2V5h-5z"/></svg>
        </button>
        <button class="icon-btn" onclick="toggleTheme()" title="ÂàáÊç¢Êó•Â§úÊ®°Âºè">
            <svg viewBox="0 0 24 24"><path d="M20 8.69V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69zM12 18c-3.31 0-6-2.69-6-6s2.69-6 6-6 6 2.69 6 6-2.69 6-6 6zm0-10c-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4-1.79-4-4-4z"/></svg>
        </button>
        <button class="icon-btn" id="settings-btn" onclick="toggleSettings()" title="ËÆæÁΩÆ: ÊÄßËÉΩ/Â≠ó‰Ωì/È¢úËâ≤">
            <svg viewBox="0 0 24 24"><path d="M19.43 12.98c.04-.32.07-.64.07-.98s-.03-.66-.07-.98l2.11-1.65c.19-.15.24-.42.12-.64l-2-3.46c-.12-.22-.39-.3-.61-.22l-2.49 1c-.52-.4-1.08-.73-1.69-.98l-.38-2.65C14.46 2.18 14.25 2 14 2h-4c-.25 0-.46.18-.5.42l-.38 2.65c-.61.25-1.17.59-1.69.98l-2.49-1c-.23-.09-.49 0-.61.22l-2 3.46c-.13.22-.07.49.12.64l2.11 1.65c-.04.32-.07.65-.07.98s.03.66.07.98l-2.11 1.65c-.19.15-.24.42-.12.64l2 3.46c.12.22.39.3.61.22l2.49-1c.52.4 1.08.73 1.69.98l.38 2.65c.04.24.25.42.5.42h4c.25 0 .46-.18.5-.42l.38-2.65c.61-.25 1.17-.59 1.69-.98l2.49 1c.23.09.49 0 .61-.22l2-3.46c.12-.22.07-.49-.12-.64l-2.11-1.65zM12 15.5c-1.93 0-3.5-1.57-3.5-3.5s1.57-3.5 3.5-3.5 3.5 1.57 3.5 3.5-1.57 3.5-3.5 3.5z"/></svg>
        </button>
        <button class="icon-btn" onclick="copySnapshot()" title="Â§çÂà∂Êï∞ÊçÆÂø´ÁÖß">
            <svg viewBox="0 0 24 24"><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"/></svg>
        </button>
        <button class="icon-btn" onclick="openSourceModal()" title="Êü•ÁúãÊ∫êÁ†Å">
            <svg viewBox="0 0 24 24"><path d="M9.4 16.6L4.8 12l4.6-4.6L8 6l-6 6 6 6 1.4-1.4zm5.2 0l4.6-4.6-4.6-4.6L16 6l6 6-6 6-1.4-1.4z"/></svg>
        </button>
    </div>

    <!-- ‰∏™ÊÄßÂåñËÆæÁΩÆÈù¢Êùø -->
    <div class="settings-panel" id="settings-panel">
        <div class="setting-group">
            <div class="setting-header">
                <div class="setting-label">ÊÄßËÉΩÊ®°Âºè (‰ΩéÈÖçÊâãÊú∫)</div>
                <label class="toggle-switch">
                    <input type="checkbox" id="perf-toggle" onchange="togglePerfMode(this)">
                    <span class="slider"></span>
                </label>
            </div>
        </div>
        <div class="setting-group">
            <div class="setting-label" style="margin-bottom:10px;">‰∏ªÈ¢òËâ≤Á≥ª</div>
            <div class="option-grid">
                <div class="color-opt active" style="background: hsl(265, 100%, 60%)" onclick="setHue(265, this)"></div>
                <div class="color-opt" style="background: hsl(200, 100%, 50%)" onclick="setHue(200, this)"></div>
                <div class="color-opt" style="background: hsl(150, 100%, 40%)" onclick="setHue(150, this)"></div>
                <div class="color-opt" style="background: hsl(25, 100%, 55%)" onclick="setHue(25, this)"></div>
            </div>
        </div>
        <div class="setting-group">
            <div class="setting-label" style="margin-bottom:10px;">Â≠ó‰ΩìÈ£éÊ†º</div>
            <div class="option-grid">
                <div class="font-opt active" style="font-family: 'Roboto', sans-serif" onclick="setFont('modern', this)">Aa</div>
                <div class="font-opt" style="font-family: 'Playfair Display', serif" onclick="setFont('serif', this)">Aa</div>
                <div class="font-opt" style="font-family: 'Press Start 2P', cursive; font-size:0.6rem" onclick="setFont('pixel', this)">Px</div>
                <div class="font-opt" style="font-family: 'Dancing Script', cursive" onclick="setFont('hand', this)">Aa</div>
            </div>
        </div>
    </div>

    <!-- ‰∏ªÂç°Áâá -->
    <main class="container">
        <h1>
            <span>Âπ¥Â∫¶ËøõÂ∫¶Êù°</span>
            <input type="number" id="year-input" class="year-input" value="2026" min="1900" max="2100" onchange="changeYear(this.value)">
        </h1>
        
        <div class="date-display" id="current-date-str">Ê≠£Âú®ÂêåÊ≠•ÂéüÂ≠êÈíü...</div>
        <div class="quote-display" id="motivational-quote">Âä†ËΩΩ‰∏≠...</div>

        <!-- Âπ¥Â∫¶ÂÆèËßÇËøõÂ∫¶ -->
        <div class="percent-wrapper">
            <div class="percent-display" id="percent-text">0.000000%</div>
        </div>
        <div class="progress-container">
            <div class="progress-bar" id="progress-bar"></div>
        </div>
        <div class="milestone-text" id="milestone-prediction">È¢ÑÊµãËÆ°ÁÆó‰∏≠...</div>

        <!-- ‰ªäÊó•ÂæÆËßÇËøõÂ∫¶ -->
        <div class="day-progress-section">
            <div class="day-label">
                <span>‰ªäÊó•ËøõÂ∫¶ (24H)</span>
                <span id="day-percent-text">0%</span>
            </div>
            <div class="day-progress-container">
                <div class="day-progress-bar" id="day-progress-bar"></div>
            </div>
        </div>

        <div class="stats-grid">
            <div class="stat-item">
                <div class="stat-value" id="days-passed">0</div>
                <div class="stat-label">Â∑≤ËøáÂ§©Êï∞</div>
            </div>
            <div class="stat-item">
                <div class="stat-value" id="days-left">0</div>
                <div class="stat-label">Ââ©‰ΩôÂ§©Êï∞</div>
            </div>
            <div class="stat-item">
                <div class="stat-value" id="hours-left">0</div>
                <div class="stat-label">Ââ©‰ΩôÂ∞èÊó∂</div>
            </div>
        </div>

        <div class="detail-title">Êó∂Á©∫ËØ¶ÊÉÖÊï∞ÊçÆ</div>
        <div class="detail-grid">
            <div class="detail-card">
                <div class="detail-val" id="current-quarter">Q1</div>
                <div class="detail-lbl">Â≠£Â∫¶</div>
            </div>
            <div class="detail-card">
                <div class="detail-val" id="day-of-year">0</div>
                <div class="detail-lbl">Á¨¨Âá†Â§©</div>
            </div>
            <div class="detail-card">
                <div class="detail-val" id="current-week">0</div>
                <div class="detail-lbl">Âë®Êï∞</div>
            </div>
            <div class="detail-card">
                <div class="detail-val" id="workdays-left">0</div>
                <div class="detail-lbl">Â∑•‰ΩúÊó•</div>
            </div>
            <div class="detail-card">
                <div class="detail-val" id="next-holiday-days">0</div>
                <div class="detail-lbl" id="next-holiday-name">ÂÅáÊúü</div>
            </div>
            <div class="detail-card">
                <div class="detail-val" id="moon-phase">üåï</div>
                <div class="detail-lbl">ÊúàÁõ∏</div>
            </div>
            <div class="detail-card">
                <div class="detail-val" id="seconds-left" style="font-size: 0.8rem;">0</div>
                <div class="detail-lbl">ÁßíÊï∞</div>
            </div>
        </div>

        <!-- Â∫ïÈÉ®Áä∂ÊÄÅÊ†è -->
        <div class="footer-info">
            <span id="fps-counter">FPS: --</span>
            <span id="perf-status">Mode: Quality</span>
        </div>
    </main>

    <!-- Ê∫êÁ†ÅÊ®°ÊÄÅÊ°Ü -->
    <div class="modal-overlay" id="source-modal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">ÂÆåÊï¥Ê∫ê‰ª£Á†Å</div>
                <button class="icon-btn" onclick="closeSourceModal()" style="width:36px;height:36px;background:transparent;border:none;box-shadow:none;">
                    <svg viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
                </button>
            </div>
            <div class="modal-body">
                <textarea class="code-area" id="source-code-area" readonly></textarea>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeSourceModal()">ÂÖ≥Èó≠</button>
                <button class="btn btn-primary" onclick="copySourceCode()" id="copy-btn">Â§çÂà∂ÂÖ®ÈÉ®‰ª£Á†Å</button>
            </div>
        </div>
    </div>

    <script>
        // ================= Áä∂ÊÄÅÁÆ°ÁêÜ =================
        let state = {
            targetYear: 2026,
            lastWorkdayCalc: 0,
            cachedWorkdays: 0,
            particleCountMobile: 40,
            particleCountDesktop: 85,
            hue: 265,
            perfMode: false,
            lastFrameTime: performance.now(),
            frameCount: 0
        };

        // ================= DOM ÂÖÉÁ¥† =================
        const els = {
            percent: document.getElementById('percent-text'),
            bar: document.getElementById('progress-bar'),
            dayPercent: document.getElementById('day-percent-text'),
            dayBar: document.getElementById('day-progress-bar'),
            date: document.getElementById('current-date-str'),
            quote: document.getElementById('motivational-quote'),
            milestone: document.getElementById('milestone-prediction'),
            passed: document.getElementById('days-passed'),
            left: document.getElementById('days-left'),
            hours: document.getElementById('hours-left'),
            quarter: document.getElementById('current-quarter'), // Fixed: Added back
            dayOfYear: document.getElementById('day-of-year'),
            week: document.getElementById('current-week'),
            workdays: document.getElementById('workdays-left'),
            seconds: document.getElementById('seconds-left'),
            nextHolDays: document.getElementById('next-holiday-days'),
            nextHolName: document.getElementById('next-holiday-name'),
            moonPhase: document.getElementById('moon-phase'),
            fps: document.getElementById('fps-counter'),
            perfStatus: document.getElementById('perf-status'),
            
            modal: document.getElementById('source-modal'),
            codeArea: document.getElementById('source-code-area'),
            copyBtn: document.getElementById('copy-btn'),
            settingsPanel: document.getElementById('settings-panel'),
            settingsBtn: document.getElementById('settings-btn')
        };

        // ================= ËÆæÁΩÆ‰∏éÊÄßËÉΩÈÄªËæë =================
        function toggleSettings() {
            els.settingsPanel.classList.toggle('open');
            els.settingsBtn.classList.toggle('active');
        }

        function togglePerfMode(el) {
            state.perfMode = el.checked;
            if (state.perfMode) {
                document.body.classList.add('perf-mode');
                els.perfStatus.textContent = "Mode: Performance";
                const canvas = document.getElementById('particle-canvas');
                const ctx = canvas.getContext('2d');
                ctx.clearRect(0, 0, canvas.width, canvas.height);
            } else {
                document.body.classList.remove('perf-mode');
                els.perfStatus.textContent = "Mode: Quality";
                initParticles(); 
            }
        }

        function setHue(hue, el) {
            state.hue = hue;
            document.documentElement.style.setProperty('--primary-hue', hue);
            document.querySelectorAll('.color-opt').forEach(opt => opt.classList.remove('active'));
            el.classList.add('active');
        }

        function setFont(type, el) {
            document.body.className = state.perfMode ? 'perf-mode' : ''; 
            document.body.classList.add('font-' + type);
            document.querySelectorAll('.font-opt').forEach(opt => opt.classList.remove('active'));
            el.classList.add('active');
        }

        document.addEventListener('click', (e) => {
            if (!els.settingsPanel.contains(e.target) && !els.settingsBtn.contains(e.target)) {
                els.settingsPanel.classList.remove('open');
                els.settingsBtn.classList.remove('active');
            }
        });

        // ================= Ê†∏ÂøÉËÆ°ÁÆóÈÄªËæë =================
        function changeYear(val) {
            const newYear = parseInt(val);
            if (newYear > 1900 && newYear < 3000) {
                state.targetYear = newYear;
                state.lastWorkdayCalc = 0;
            }
        }

        function getWeekNumber(d) {
            d = new Date(Date.UTC(d.getFullYear(), d.getMonth(), d.getDate()));
            d.setUTCDate(d.getUTCDate() + 4 - (d.getUTCDay()||7));
            var yearStart = new Date(Date.UTC(d.getUTCFullYear(),0,1));
            return Math.ceil((((d - yearStart) / 86400000) + 1)/7);
        }
        
        function getDayOfYear(now) {
            const start = new Date(now.getFullYear(), 0, 0);
            const diff = now - start;
            const oneDay = 1000 * 60 * 60 * 24;
            return Math.floor(diff / oneDay);
        }

        function getWorkdaysLeft(now, endOfYear) {
            let count = 0;
            let current = new Date(now);
            while (current <= endOfYear) {
                const day = current.getDay();
                if (day !== 0 && day !== 6) count++;
                current.setDate(current.getDate() + 1);
            }
            return count;
        }

        function getMoonPhase(date) {
            const synodic = 29.53058867;
            const msPerDay = 86400000;
            const baseDate = new Date("2000-01-06T18:14:00Z");
            const daysSince = (date - baseDate) / msPerDay;
            const phase = (daysSince % synodic) / synodic; 
            if (phase < 0.03 || phase > 0.97) return "üåë Êñ∞Êúà";
            if (phase < 0.22) return "üåí Â≥®Áúâ";
            if (phase < 0.28) return "üåì ‰∏äÂº¶";
            if (phase < 0.47) return "üåî ÁõàÂá∏";
            if (phase < 0.53) return "üåï Êª°Êúà";
            if (phase < 0.72) return "üåñ ‰∫èÂá∏";
            if (phase < 0.78) return "üåó ‰∏ãÂº¶";
            return "üåò ÊÆãÊúà";
        }

        function getNextHoliday(now) {
            const year = now.getFullYear();
            const holidays = [
                { name: "ÂÖÉÊó¶", date: new Date(year, 0, 1) },
                { name: "ÊÉÖ‰∫∫ËäÇ", date: new Date(year, 1, 14) },
                { name: "Âä≥Âä®ËäÇ", date: new Date(year, 4, 1) },
                { name: "ÂÑøÁ´•ËäÇ", date: new Date(year, 5, 1) },
                { name: "ÂõΩÂ∫ÜËäÇ", date: new Date(year, 9, 1) },
                { name: "Âú£ËØûËäÇ", date: new Date(year, 11, 25) },
                { name: "ÂÖÉÊó¶", date: new Date(year + 1, 0, 1) }
            ];
            for (let h of holidays) {
                if (h.date > now) {
                    const diff = Math.ceil((h.date - now) / 86400000);
                    return { name: h.name, days: diff };
                }
            }
            return { name: "Êú™Áü•", days: 0 };
        }

        function getQuote(percentage) {
            if (percentage <= 0) return "Êú™Êù•Êú™Ëá≥ÔºåËìÑÂäø‰ª•ÂæÖ„ÄÇ";
            if (percentage < 10) return "‰∏á‰∫ãÂºÄÂ§¥ÈöæÔºå‰πæÂù§Êú™ÂÆö„ÄÇ";
            if (percentage < 30) return "Áßç‰∏ÄÊ£µÊ†ëÊúÄÂ•ΩÁöÑÊó∂Èó¥ÊòØÂçÅÂπ¥ÂâçÔºåÂÖ∂Ê¨°ÊòØÁé∞Âú®„ÄÇ";
            if (percentage < 50) return "ÂùöÊåÅ‰∏çÊáàÔºåÈáèÂèòÁªàÂ∞ÜÂºïËµ∑Ë¥®Âèò„ÄÇ";
            if (percentage === 50) return "Ë°åËá≥ÂçäÁ®ãÔºå‰∏çÂøòÂàùÂøÉÔºåÊñπÂæóÂßãÁªà„ÄÇ";
            if (percentage < 80) return "Âì™ÊÄïÊ≠§Êó∂Ê≠§ÂàªÔºå‰Ω†ÁöÑÁ´û‰∫âÂØπÊâã‰πüÂú®ÁøªÂä®‰π¶È°µ„ÄÇ";
            if (percentage < 95) return "ÈªéÊòéÂâçÊúÄÈªëÊöóÔºåËÉúÂà©ÂâçÊúÄÁªùÊúõ„ÄÇ";
            if (percentage < 100) return "ÊúÄÂêéÁöÑÂÜ≤Âà∫ÔºåÊàêË¥•Âú®Ê≠§‰∏Ä‰∏æÔºÅ";
            return "ÂæÄ‰∫ãÊ∏ÖÈõ∂ÔºåÁà±ÊÅ®ÈöèÊÑèÔºåÂºÄÂêØÊñ∞ÁØáÁ´†„ÄÇ";
        }

        function predictMilestone(start, end, currentPercentage) {
            const nextPercent = Math.floor(currentPercentage) + 1;
            if (nextPercent > 100) return "Â∑≤ËææÊàêÊâÄÊúâÈáåÁ®ãÁ¢ë";
            const totalDuration = end - start;
            const timeForNext = totalDuration * (nextPercent / 100);
            const milestoneDate = new Date(start.getTime() + timeForNext);
            const month = milestoneDate.getMonth() + 1;
            const day = milestoneDate.getDate();
            const hour = milestoneDate.getHours().toString().padStart(2, '0');
            const min = milestoneDate.getMinutes().toString().padStart(2, '0');
            return `È¢ÑËÆ° ${month}Êúà${day}Êó• ${hour}:${min} ËææÂà∞ ${nextPercent}%`;
        }

        // ================= ‰∏ªÂæ™ÁéØ =================
        function updateProgress() {
            const nowTime = performance.now();
            state.frameCount++;
            if (nowTime - state.lastFrameTime >= 1000) {
                els.fps.textContent = `FPS: ${state.frameCount}`;
                state.frameCount = 0;
                state.lastFrameTime = nowTime;
            }

            const now = new Date();
            
            // 1. ‰ªäÊó•ËøõÂ∫¶
            const startOfDay = new Date(now.getFullYear(), now.getMonth(), now.getDate());
            const msPassedToday = now - startOfDay;
            const dayPercent = (msPassedToday / 86400000) * 100;
            els.dayPercent.textContent = dayPercent.toFixed(1) + '%';
            els.dayBar.style.width = dayPercent + '%';

            // 2. Âπ¥Â∫¶ËøõÂ∫¶
            const startOfYear = new Date(state.targetYear, 0, 1);
            const endOfYear = new Date(state.targetYear + 1, 0, 1);
            
            els.date.textContent = now.toLocaleDateString('zh-CN', { 
                year: 'numeric', month: 'long', day: 'numeric', weekday: 'long',
                hour: '2-digit', minute: '2-digit', second: '2-digit'
            });

            const totalMs = endOfYear - startOfYear;
            const currentMs = now - startOfYear;
            let percent = 0;

            if (now < startOfYear) {
                percent = 0;
                els.passed.textContent = "Êú™ÂºÄÂßã";
                els.left.textContent = Math.ceil((startOfYear - now) / 86400000);
                els.hours.textContent = "--"; els.workdays.textContent = "--"; els.seconds.textContent = "--";
                els.quote.textContent = `Á≠âÂæÖ ${state.targetYear} ÂêØËà™...`;
                els.milestone.textContent = "Êó∂Èó¥ËΩ¥Â∞öÊú™ÂêØÂä®";
            } else if (now > endOfYear) {
                percent = 100;
                els.passed.textContent = "Â∑≤ÁªìÊùü";
                els.left.textContent = 0; els.hours.textContent = 0; els.workdays.textContent = 0; els.seconds.textContent = 0;
                els.quote.textContent = `${state.targetYear} Â∑≤Êàê‰∏∫ÂéÜÂè≤„ÄÇ`;
                els.milestone.textContent = "Êú¨Âπ¥Â∫¶Â∑≤ÂÆåÁªì";
            } else {
                percent = (currentMs / totalMs) * 100;
                els.passed.textContent = Math.floor(currentMs / 86400000);
                const msLeft = endOfYear - now;
                els.left.textContent = Math.floor(msLeft / 86400000);
                els.hours.textContent = Math.floor(msLeft / 3600000);
                els.seconds.textContent = Math.floor(msLeft / 1000).toLocaleString();
                els.quote.textContent = getQuote(percent);
                
                const q = Math.floor((now.getMonth() + 3) / 3);
                if(els.quarter) els.quarter.textContent = `Q${q}`; // Safe check added
                
                els.week.textContent = `${getWeekNumber(now)}`;
                els.dayOfYear.textContent = `${getDayOfYear(now)}`;
                
                // ÁºìÂ≠òÊÖ¢ÈÄüËÆ°ÁÆó
                if (now.getTime() - state.lastWorkdayCalc > 60000) {
                    state.cachedWorkdays = getWorkdaysLeft(now, endOfYear);
                    state.cachedHoliday = getNextHoliday(now);
                    state.cachedMoon = getMoonPhase(now);
                    state.lastWorkdayCalc = now.getTime();
                }
                els.workdays.textContent = state.cachedWorkdays;
                els.nextHolDays.textContent = state.cachedHoliday ? state.cachedHoliday.days : '-';
                els.nextHolName.textContent = state.cachedHoliday ? state.cachedHoliday.name : 'ÂÅáÊúü';
                els.moonPhase.textContent = state.cachedMoon || 'üåï';
                
                els.milestone.textContent = predictMilestone(startOfYear, endOfYear, percent);
            }

            els.percent.textContent = percent.toFixed(6) + '%';
            els.bar.style.width = percent.toFixed(4) + '%';
            
            requestAnimationFrame(updateProgress);
        }

        // ================= Á≤íÂ≠êËÉåÊôØ =================
        const canvas = document.getElementById('particle-canvas');
        const ctx = canvas.getContext('2d');
        let particles = [];

        function resizeCanvas() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            if (!state.perfMode) initParticles();
        }
        window.addEventListener('resize', resizeCanvas);

        class Particle {
            constructor() { this.reset(); }
            reset() {
                this.x = Math.random() * canvas.width;
                this.y = Math.random() * canvas.height;
                this.vx = (Math.random() - 0.5) * 0.2;
                this.vy = (Math.random() - 0.5) * 0.2;
                this.size = Math.random() * 2 + 0.5;
                this.opacity = Math.random() * 0.5 + 0.1;
            }
            update() {
                this.x += this.vx; this.y += this.vy;
                if (this.x < 0 || this.x > canvas.width || this.y < 0 || this.y > canvas.height) this.reset();
            }
            draw() {
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
                const isDark = document.body.getAttribute('data-theme') === 'dark';
                ctx.fillStyle = isDark ? `rgba(255, 255, 255, ${this.opacity})` : `rgba(45, 52, 54, ${this.opacity})`;
                ctx.fill();
            }
        }

        function initParticles() {
            particles = [];
            let count = window.innerWidth < 480 ? state.particleCountMobile : state.particleCountDesktop;
            if (state.perfMode) count = 0; 
            for (let i = 0; i < count; i++) particles.push(new Particle());
        }

        function animateParticles() {
            if (!state.perfMode) {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                const isDark = document.body.getAttribute('data-theme') === 'dark';
                particles.forEach((p, index) => {
                    p.update(); p.draw();
                    for (let j = index + 1; j < particles.length; j++) {
                        const p2 = particles[j];
                        const dx = p.x - p2.x; const dy = p.y - p2.y;
                        const dist = Math.sqrt(dx * dx + dy * dy);
                        if (dist < 100) {
                            ctx.beginPath();
                            ctx.strokeStyle = isDark ? `rgba(255, 255, 255, ${0.08 - dist/1200})` : `rgba(45, 52, 54, ${0.08 - dist/1200})`;
                            ctx.lineWidth = 0.5; ctx.moveTo(p.x, p.y); ctx.lineTo(p2.x, p2.y); ctx.stroke();
                        }
                    }
                });
            }
            requestAnimationFrame(animateParticles);
        }

        // ================= ËæÖÂä©ÂäüËÉΩ =================
        function copySnapshot() {
            const txt = `üìÖ ${state.targetYear}ËøõÂ∫¶\nüìä Âπ¥ËøõÂ∫¶Ôºö${els.percent.textContent}\nüåû ‰ªäÊó•Ôºö${els.dayPercent.textContent}\n‚è≥ Ââ©‰ΩôÔºö${els.left.textContent}Â§©\nüåï ÊúàÁõ∏Ôºö${els.moonPhase.textContent}`;
            const textArea = document.createElement("textarea");
            textArea.value = txt; document.body.appendChild(textArea); textArea.select();
            document.execCommand("copy"); document.body.removeChild(textArea);
            alert("‚úÖ Êï∞ÊçÆÂø´ÁÖßÂ∑≤Â§çÂà∂ÔºÅ");
        }

        function openSourceModal() {
            els.codeArea.value = document.documentElement.outerHTML;
            els.modal.classList.add('active');
        }
        function closeSourceModal() {
            els.modal.classList.remove('active');
            setTimeout(() => {
                els.copyBtn.textContent = "Â§çÂà∂ÂÖ®ÈÉ®‰ª£Á†Å";
                els.copyBtn.classList.replace('btn-secondary', 'btn-primary');
            }, 300);
        }
        function copySourceCode() {
            els.codeArea.select(); document.execCommand('copy');
            els.copyBtn.textContent = "Â§çÂà∂ÊàêÂäüÔºÅ";
            els.copyBtn.classList.replace('btn-primary', 'btn-secondary');
        }
        els.modal.addEventListener('click', (e) => { if (e.target === els.modal) closeSourceModal(); });

        function toggleTheme() {
            const body = document.body;
            body.getAttribute('data-theme') === 'dark' ? body.removeAttribute('data-theme') : body.setAttribute('data-theme', 'dark');
        }
        if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) document.body.setAttribute('data-theme', 'dark');

        function toggleFullScreen() {
            !document.fullscreenElement ? document.documentElement.requestFullscreen().catch(e=>{}) : document.exitFullscreen && document.exitFullscreen();
        }

        // ================= ÂêØÂä® =================
        resizeCanvas(); animateParticles(); updateProgress();
    </script>
</body>
</html>
