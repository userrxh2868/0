<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>MD3 ÁªàÊûÅ‰∫ïÂ≠óÊ£ã</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        :root {
            /* MD3 Deep Dark Theme */
            --md-sys-color-primary: #d0bcff;
            --md-sys-color-on-primary: #381e72;
            --md-sys-color-primary-container: #4f378b;
            --md-sys-color-on-primary-container: #eaddff;
            --md-sys-color-secondary: #ccc2dc;
            --md-sys-color-background: #141218;
            --md-sys-color-surface: #1d1b20;
            --md-sys-color-surface-variant: #49454f;
            --md-sys-color-on-surface: #e6e1e5;
            --md-sys-color-error: #f2b8b5;
            --md-sys-color-outline: #938f99;
            
            --radius-l: 28px;
            --radius-m: 16px;
            --radius-s: 12px;
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; user-select: none; }

        body {
            margin: 0;
            background-color: var(--md-sys-color-background);
            color: var(--md-sys-color-on-surface);
            font-family: 'Roboto', sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            overflow: hidden;
        }

        /* Toast Notification */
        .toast-container {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 200;
            display: flex;
            flex-direction: column;
            gap: 10px;
            pointer-events: none;
        }

        .toast {
            background: var(--md-sys-color-surface-variant);
            color: var(--md-sys-color-on-surface);
            padding: 12px 24px;
            border-radius: 50px;
            font-size: 0.9rem;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            opacity: 0;
            transform: translateY(-20px);
            transition: all 0.3s cubic-bezier(0.2, 0, 0, 1);
            text-align: center;
        }
        .toast.show { opacity: 1; transform: translateY(0); }

        /* Header */
        header { text-align: center; margin-bottom: 2vh; }
        h1 { margin: 0; font-size: 2rem; letter-spacing: -0.5px; color: var(--md-sys-color-primary); }
        .status-chip {
            display: inline-flex;
            align-items: center;
            background: var(--md-sys-color-primary-container);
            color: var(--md-sys-color-on-primary-container);
            padding: 6px 16px;
            border-radius: 8px;
            margin-top: 8px;
            font-size: 0.9rem;
            font-weight: 500;
            transition: all 0.3s;
        }

        /* Game Board */
        .board-container {
            position: relative;
            background: var(--md-sys-color-surface);
            padding: 16px;
            border-radius: var(--radius-l);
            box-shadow: 0 10px 30px rgba(0,0,0,0.4);
            margin-bottom: 20px;
        }

        .board {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
            width: 80vw;
            max-width: 340px;
            aspect-ratio: 1/1;
        }

        .cell {
            background: #2b2930;
            border-radius: var(--radius-s);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 3rem;
            font-weight: 700;
            cursor: pointer;
            transition: background 0.2s, transform 0.1s;
        }
        
        .cell:active { background: #36343b; transform: scale(0.95); }
        .cell.x { color: var(--md-sys-color-primary); }
        .cell.o { color: var(--md-sys-color-error); }
        .cell.winner { background: rgba(208, 188, 255, 0.2); }

        /* Winning Line SVG */
        .win-line-svg {
            position: absolute;
            top: 16px; left: 16px;
            width: calc(100% - 32px);
            height: calc(100% - 32px);
            pointer-events: none;
            z-index: 10;
        }
        .win-line {
            stroke: var(--md-sys-color-primary);
            stroke-width: 6;
            stroke-linecap: round;
            stroke-dasharray: 400;
            stroke-dashoffset: 400;
            transition: stroke-dashoffset 0.5s ease-out;
        }
        .win-line.draw { stroke-dashoffset: 0; }

        /* Controls */
        .controls { display: flex; gap: 12px; }
        
        .btn-reset {
            background: var(--md-sys-color-primary);
            color: var(--md-sys-color-on-primary);
            border: none;
            padding: 14px 32px;
            border-radius: 100px;
            font-size: 1rem;
            font-weight: 500;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            cursor: pointer;
            transition: transform 0.2s;
        }
        .btn-reset:active { transform: scale(0.96); }

        /* FAB */
        .fab {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 60px;
            height: 60px;
            border-radius: 20px; /* MD3 Squircle */
            background: var(--md-sys-color-secondary);
            color: #1d1b20;
            border: none;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 6px 16px rgba(0,0,0,0.4);
            z-index: 100;
            transition: all 0.3s cubic-bezier(0.3, 0, 0, 1);
            cursor: pointer;
        }
        .fab:active { transform: scale(0.9) rotate(15deg); }
        .fab svg { width: 28px; height: 28px; fill: currentColor; }

        /* Modals */
        .modal-backdrop {
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.7);
            backdrop-filter: blur(4px);
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s;
            z-index: 150;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .modal-backdrop.active { opacity: 1; pointer-events: auto; }

        .modal {
            background: #25232a;
            width: 85%;
            max-width: 320px;
            padding: 24px;
            border-radius: var(--radius-l);
            transform: scale(0.9);
            opacity: 0;
            transition: all 0.3s cubic-bezier(0.2, 0, 0, 1);
            border: 1px solid #49454f;
        }
        .modal-backdrop.active .modal { transform: scale(1); opacity: 1; }
        
        .modal h2 { margin-top: 0; color: var(--md-sys-color-primary); font-size: 1.5rem; }
        .modal p { color: var(--md-sys-color-on-surface); opacity: 0.8; }

        /* Inputs */
        .md-input {
            width: 100%;
            background: #1d1b20;
            border: 1px solid var(--md-sys-color-outline);
            color: white;
            padding: 16px;
            border-radius: 8px;
            font-size: 1.2rem;
            text-align: center;
            margin: 16px 0;
            outline: none;
        }
        .md-input:focus { border-color: var(--md-sys-color-primary); border-width: 2px; padding: 15px; }

        /* Cheat Grid */
        .cheat-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-top: 10px;
        }
        .cheat-btn {
            background: var(--md-sys-color-surface-variant);
            color: var(--md-sys-color-on-surface);
            border: none;
            padding: 12px 8px;
            border-radius: 12px;
            font-size: 0.85rem;
            cursor: pointer;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 5px;
        }
        .cheat-btn.active { background: var(--md-sys-color-primary-container); color: var(--md-sys-color-on-primary-container); border: 1px solid var(--md-sys-color-primary); }
        .cheat-btn span { font-size: 1.2rem; }
        .cheat-btn small { font-size: 0.7rem; opacity: 0.7; }

        /* Animation */
        .shake { animation: shake 0.4s cubic-bezier(.36,.07,.19,.97) both; }
        @keyframes shake { 10%, 90% { transform: translate3d(-1px, 0, 0); } 20%, 80% { transform: translate3d(2px, 0, 0); } 30%, 50%, 70% { transform: translate3d(-4px, 0, 0); } 40%, 60% { transform: translate3d(4px, 0, 0); } }

    </style>
</head>
<body>

    <div class="toast-container" id="toastContainer"></div>

    <header>
        <h1>‰∫ïÂ≠óÊ£ã PRO</h1>
        <div class="status-chip" id="status">Áé©ÂÆ∂ (X) vs ÊûÅÊô∫AI (O)</div>
    </header>

    <div class="board-container">
        <div class="board" id="board"></div>
        <!-- Winning Line Container -->
        <svg class="win-line-svg"><line x1="0" y1="0" x2="0" y2="0" class="win-line" id="winLine" /></svg>
    </div>

    <div class="controls">
        <button class="btn-reset" onclick="resetGame()">ÈáçÊñ∞ÂºÄÂßã</button>
    </div>

    <!-- Magic Button -->
    <button class="fab" id="fab">
        <svg viewBox="0 0 24 24"><path d="M7.5 5.6L10 7 8.6 4.5 10 2 7.5 3.4 5 2 6.4 4.5 5 7zM19 2l-1.4 2.5L15 5.9l2.6 1.4L19 9.8l1.4-2.5L23 5.9l-2.6-1.4zM16.8 11.6c-2.5-.4-4.8-2.5-5.2-5L10 15.2l6.8 6.8 8.4-8.4-8.4-2z"/></svg>
    </button>

    <!-- Password Modal -->
    <div class="modal-backdrop" id="authModal">
        <div class="modal">
            <h2>ÂºÄÂèëËÄÖÊ®°Âºè</h2>
            <p>ËæìÂÖ•Ê†∏ÂøÉÂØÜÈí•‰ª•Ëé∑Âèñ‰∏äÂ∏ùÊùÉÈôê</p>
            <input type="tel" id="pwd" class="md-input" placeholder="114514" maxlength="6">
            <div style="display: flex; justify-content: flex-end; gap: 10px;">
                <button class="cheat-btn" style="background:transparent" onclick="closeModals()">ÂèñÊ∂à</button>
                <button class="cheat-btn" style="background:var(--md-sys-color-primary); color:black" onclick="verifyPwd()">Ëß£ÈîÅ</button>
            </div>
        </div>
    </div>

    <!-- Cheat Menu -->
    <div class="modal-backdrop" id="cheatModal">
        <div class="modal">
            <h2 style="color: var(--md-sys-color-error)">God Mode</h2>
            <div class="cheat-grid">
                <button class="cheat-btn" id="btnDumb" onclick="toggleCheat('dumb')">
                    <span>üß†</span>ÈôçÊô∫ÊâìÂáª<small>AIÂèòÂÇªÁìú</small>
                </button>
                <button class="cheat-btn" id="btnFreeze" onclick="toggleCheat('freeze')">
                    <span>‚ùÑÔ∏è</span>Êó∂Èó¥ÂÅúÊ≠¢<small>AI‰∏çËµ∞Ê£ã</small>
                </button>
                <button class="cheat-btn" onclick="triggerCheat('win')">
                    <span>üöÄ</span>ÂÖâÈÄüËé∑ËÉú<small>Áõ¥Êé•ÁªìÊùü</small>
                </button>
                <button class="cheat-btn" onclick="triggerCheat('undo')">
                    <span>‚Ü©Ô∏è</span>Êó∂ÂÖâÂÄíÊµÅ<small>ÊÇîÊ£ã‰∏§Ê≠•</small>
                </button>
                <button class="cheat-btn" onclick="triggerCheat('swap')">
                    <span>üé≠</span>ÁßªÂΩ¢Êç¢ÂΩ±<small>‰∫§Êç¢ÂèåÊñπÊ£ãÂ≠ê</small>
                </button>
                <button class="cheat-btn" onclick="triggerCheat('nuke')">
                    <span>üí£</span>ÊàòÊúØÊ†∏Êòæ<small>Ê∏ÖÁ©∫AIÊ£ãÂ≠ê</small>
                </button>
            </div>
            <button class="cheat-btn" style="width:100%; margin-top:15px;" onclick="closeModals()">ÂÖ≥Èó≠ËèúÂçï</button>
        </div>
    </div>

    <script>
        /**
         * State & Init
         */
        const boardEl = document.getElementById('board');
        const statusEl = document.getElementById('status');
        const winLine = document.getElementById('winLine');
        
        let gameState = Array(9).fill(null);
        let gameActive = true;
        let player = 'X';
        let ai = 'O';
        
        // Cheat States
        let isAuth = false;
        let cheats = {
            dumb: false,
            freeze: false
        };

        function init() {
            boardEl.innerHTML = '';
            gameState = Array(9).fill(null);
            gameActive = true;
            winLine.classList.remove('draw');
            statusEl.innerText = "Áé©ÂÆ∂ (X) vs ÊûÅÊô∫AI (O)";
            
            for(let i=0; i<9; i++) {
                let cell = document.createElement('div');
                cell.className = 'cell';
                cell.dataset.idx = i;
                cell.onclick = () => onUserClick(i);
                boardEl.appendChild(cell);
            }
        }
        init();

        /**
         * Gameplay
         */
        function onUserClick(idx) {
            if(!gameActive || gameState[idx]) return;
            
            move(idx, player);
            
            if(gameActive) {
                if(cheats.freeze) {
                    showToast("‚ùÑÔ∏è AI Â∑≤ÂÜªÁªìÔºåËØ∑ÁªßÁª≠");
                } else {
                    statusEl.innerText = "AI ÊÄùËÄÉ‰∏≠...";
                    // Add slight delay for realism
                    setTimeout(aiTurn, 400);
                }
            }
        }

        function move(idx, side) {
            gameState[idx] = side;
            const cell = boardEl.children[idx];
            cell.classList.add(side.toLowerCase());
            cell.innerText = side;
            vibrate(10); // Light haptic

            const win = checkWin(gameState, side);
            if(win) {
                endGame(side, win);
                return;
            }
            
            if(!gameState.includes(null)) {
                gameActive = false;
                statusEl.innerText = "Âπ≥Â±ÄÔºÅ(ÂäøÂùáÂäõÊïå)";
                vibrate(50);
            }
        }

        function aiTurn() {
            if(!gameActive) return;

            let idx;
            if(cheats.dumb) {
                // Random Move
                let empties = gameState.map((v,i) => v===null ? i : null).filter(v=>v!==null);
                idx = empties[Math.floor(Math.random()*empties.length)];
            } else {
                // Minimax
                idx = minimax(gameState, ai).index;
            }
            
            if(idx !== undefined) {
                move(idx, ai);
                if(gameActive) statusEl.innerText = "ËΩÆÂà∞‰Ω†‰∫Ü";
            }
        }

        function endGame(winner, pattern) {
            gameActive = false;
            statusEl.innerText = winner === player ? "üéâ ÊÅ≠ÂñúËé∑ËÉúÔºÅ" : "üíÄ ‰Ω†Ëæì‰∫ÜÔºåÂÜçÊù•Ôºü";
            vibrate(100); // Heavy haptic
            drawWinLine(pattern);
        }

        /**
         * AI Logic (Minimax)
         */
        function checkWin(board, side) {
            const wins = [[0,1,2],[3,4,5],[6,7,8],[0,3,6],[1,4,7],[2,5,8],[0,4,8],[2,4,6]];
            for(let w of wins) {
                if(board[w[0]] === side && board[w[1]] === side && board[w[2]] === side) return w;
            }
            return null;
        }

        function minimax(newBoard, player) {
            let avail = newBoard.map((v,i) => v===null ? i : null).filter(v=>v!==null);
            
            if (checkWin(newBoard, player === ai ? player : ai)) return {score: -10};
            if (checkWin(newBoard, player === ai ? ai : player)) return {score: 10};
            if (avail.length === 0) return {score: 0};

            let moves = [];
            for (let i = 0; i < avail.length; i++) {
                let move = {};
                move.index = avail[i];
                newBoard[avail[i]] = player;

                if (player === ai) {
                    let result = minimax(newBoard, this.player); // 'this.player' refers to global scope issue, fixed logic below
                    move.score = minimax(newBoard, window.player).score;
                } else {
                    move.score = minimax(newBoard, ai).score;
                }

                newBoard[avail[i]] = null;
                moves.push(move);
            }

            let bestMove;
            if (player === ai) {
                let bestScore = -10000;
                for (let i = 0; i < moves.length; i++) {
                    if (moves[i].score > bestScore) {
                        bestScore = moves[i].score;
                        bestMove = i;
                    }
                }
            } else {
                let bestScore = 10000;
                for (let i = 0; i < moves.length; i++) {
                    if (moves[i].score < bestScore) {
                        bestScore = moves[i].score;
                        bestMove = i;
                    }
                }
            }
            return moves[bestMove];
        }

        /**
         * Visuals
         */
        function drawWinLine(pattern) {
            if(!pattern) return;
            // Coordinates calculation for line drawing
            const getCenter = (idx) => {
                const cell = boardEl.children[idx];
                return {
                    x: cell.offsetLeft + cell.offsetWidth / 2,
                    y: cell.offsetTop + cell.offsetHeight / 2
                };
            };
            const start = getCenter(pattern[0]);
            const end = getCenter(pattern[2]);

            winLine.setAttribute('x1', start.x);
            winLine.setAttribute('y1', start.y);
            winLine.setAttribute('x2', end.x);
            winLine.setAttribute('y2', end.y);
            
            // Trigger animation
            winLine.style.display = 'block';
            // Force reflow
            void winLine.offsetWidth; 
            winLine.classList.add('draw');
        }

        function showToast(msg) {
            const t = document.createElement('div');
            t.className = 'toast';
            t.innerText = msg;
            document.getElementById('toastContainer').appendChild(t);
            setTimeout(()=>t.classList.add('show'), 10);
            setTimeout(()=>{
                t.classList.remove('show');
                setTimeout(()=>t.remove(), 300);
            }, 2000);
        }
        
        function vibrate(ms) {
            if(navigator.vibrate) navigator.vibrate(ms);
        }

        function resetGame() {
            init();
            showToast("Ê∏∏ÊàèÂ∑≤ÈáçÁΩÆ");
        }

        /**
         * Cheats & Modals
         */
        const fab = document.getElementById('fab');
        const authModal = document.getElementById('authModal');
        const cheatModal = document.getElementById('cheatModal');
        const pwdInput = document.getElementById('pwd');

        fab.onclick = () => {
            if(isAuth) openModal(cheatModal);
            else {
                pwdInput.value = '';
                openModal(authModal);
                setTimeout(() => pwdInput.focus(), 100);
            }
        };

        function openModal(el) { el.classList.add('active'); }
        function closeModals() {
            document.querySelectorAll('.modal-backdrop').forEach(m => m.classList.remove('active'));
        }

        function verifyPwd() {
            if(pwdInput.value === '114514') {
                isAuth = true;
                closeModals();
                showToast("üîì ÂºÄÂèëËÄÖÊ®°ÂºèÂ∑≤Ëß£ÈîÅ");
                setTimeout(() => openModal(cheatModal), 300);
            } else {
                pwdInput.classList.add('shake');
                showToast("üö´ ÂØÜÁ†ÅÈîôËØØ (Try: 114514)");
                setTimeout(()=>pwdInput.classList.remove('shake'), 500);
            }
        }

        function toggleCheat(key) {
            cheats[key] = !cheats[key];
            const btn = document.getElementById(key === 'dumb' ? 'btnDumb' : 'btnFreeze');
            btn.classList.toggle('active', cheats[key]);
            showToast(cheats[key] ? "‚úÖ ÂäüËÉΩÂ∑≤ÂºÄÂêØ" : "‚ùå ÂäüËÉΩÂ∑≤ÂÖ≥Èó≠");
            vibrate(20);
        }

        function triggerCheat(type) {
            if(!gameActive && type !== 'win') { showToast("Ê∏∏ÊàèÂ∑≤ÁªìÊùüÔºåËØ∑ÈáçÂºÄ"); return; }

            switch(type) {
                case 'win':
                    gameState.forEach((v,i) => {
                        if(v===null) {
                            gameState[i] = player;
                            boardEl.children[i].innerText = player;
                            boardEl.children[i].classList.add('x');
                        }
                    });
                    endGame(player, null); // No line for instant win
                    showToast("üöÄ Âº∫Ë°åËé∑ËÉúÔºÅ");
                    break;
                case 'undo':
                    // Remove last 2 moves
                    let moves = gameState.map((v,i)=>v?i:null).filter(v=>v!==null);
                    if(moves.length < 2) { showToast("Ê≠•Êï∞‰∏çË∂≥"); return; }
                    let last = moves.pop();
                    let prev = moves.pop();
                    gameState[last] = null; gameState[prev] = null;
                    [last, prev].forEach(i => {
                        boardEl.children[i].innerText = '';
                        boardEl.children[i].className = 'cell';
                    });
                    showToast("‚è≥ Êó∂ÂÖâÂÄíÊµÅÊàêÂäü");
                    break;
                case 'swap':
                    // Swap logic
                    for(let i=0; i<9; i++) {
                        if(gameState[i] === 'X') gameState[i] = 'O';
                        else if(gameState[i] === 'O') gameState[i] = 'X';
                        
                        // Update UI
                        let c = boardEl.children[i];
                        c.className = 'cell';
                        if(gameState[i]) {
                            c.innerText = gameState[i];
                            c.classList.add(gameState[i].toLowerCase());
                        }
                    }
                    showToast("üé≠ Ë∫´‰ªΩ‰∫íÊç¢ÔºÅAI Êáµ‰∫Ü");
                    break;
                case 'nuke':
                    // Remove all O
                    for(let i=0; i<9; i++) {
                        if(gameState[i] === 'O') {
                            gameState[i] = null;
                            boardEl.children[i].className = 'cell';
                            boardEl.children[i].innerText = '';
                        }
                    }
                    showToast("üí£ ÊïåÂÜõÂ∑≤Ê∏ÖÈô§");
                    break;
            }
            closeModals();
        }
    </script>
</body>
</html>
